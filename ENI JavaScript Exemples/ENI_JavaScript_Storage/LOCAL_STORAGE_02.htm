<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">

<!--
NOM DU SCRIPT : LOCAL_STORAGE_02.htm
REALISATION INFORMATIQUE : Christian VIGOUROUX
DATE DE CREATION : 01/01/2014
DATE DE DERNIERE MODIFICATION : 01/01/2014
OBJET : Stockage avec utilisation de localStorage et JSON
-->

<!-- Début script HTML -->
<html>

	<!-- Début entête script HTML -->
	<head>

		<!-- Balise meta -->
		<meta http-equiv="Content-Type"
		content="text/html; charset=utf-8" />

		<!-- Titre du script HTML -->
		<title>LOCAL_STORAGE_02</title>

		<!-- Début script JavaScript -->
		<script type='text/javascript'>
		
			/* Fonction ecrireLocalStorage */
			function ecrireLocalStorage() {
				/* Test possibilité d'utiliser localStorage et JSON */
				if ( typeof localStorage != "undefined" && JSON) {
					/* Définition d'un objet Javascript
					 coordonneesPersonne */
					var coordonneesPersonne = {
						nom : document.getElementById("nom").value,
						prenom : document.getElementById("prenom").value,
						mail : document.getElementById("mail").value
					};
					/* Sérialisation en un objet JSON de nom identite */
					localStorage.setItem("identite", JSON.stringify(coordonneesPersonne));
					/* Affichage de contrôle */
					alert("Enregistrement dans localStorage effectué");
				} else {
					/* Message d'erreur (pas de possibilité
					 de stockage localStorage) */
					alert("localStorage n'est pas supporté");
				}
			};

			/* Fonction supprimerLocalStorage */
			function supprimerLocalStorage() {
				/* Test possibilité d'utiliser localStorage et JSON */
				if ( typeof localStorage != "undefined" && JSON) {
					/* Suppression de l'entrée identite
					dans le localStorage */
					/* NB : sessionStorage.clear(); supprimerait
					également l'ensemble des entrées du localStorage */
					sessionStorage.removeItem("identite");
					/* Mise à jour des champs d'affichage
					(<input type="texte" ... />) */
					document.getElementById("nom").value = "";
					document.getElementById("prenom").value = "";
					document.getElementById("mail").value = "";
					/* Affichage de contrôle */
					alert("Suppression de l'entrée identite dans le localStorage effectuée");
				} else {
					/* Message d'erreur (pas de possibilité
					de stockage localStorage) */
					alert("localStorage n'est pas supporté");
				}
			};

		</script>

	</head>

	<!-- Début section body du script HTML -->
	<body>

		<!-- Titre du traitement -->
		<h1>Editions ENI - JavaScript - LOCAL_STORAGE_02</h1>

		<!-- Début script JavaScript -->
		<script type='text/javascript'>
		
			/* Affichage du nom du script */
			alert("LOCAL_STORAGE_02");

		</script>

		<!-- Tableau de saisie et d'affichage des champs nom,
		prénom et mail -->
		<table>
			<tr>
				<td>Nom</td>
				<td>
				<input
					type="text"
					id="nom"
					value=""
					size="40"
				/>
				</td>
			</tr>
			<tr>
				<td>Prénom</td>
				<td>
				<input
					type="text"
					id="prenom"
					value=""
					size="40"
				/>
				</td>
			</tr>
			<tr>
				<td>Mail</td>
				<td>
				<input
					type="text"
					id="mail"
					value=""
					size="40"
				/>
				</td>
			</tr>
		</table>

		<!-- Formulaire avec boutons d'écriture,
		de lecture et de suppression -->
		<br />
		<form>
			<input
				type="button"
				id="boutonEcriture"
				value="Ecriture dans localStorage"
				onclick="ecrireLocalStorage();"
			/>
			<br />
			<input
				type="button"
				id="boutonLecture"
				value="Lecture depuis localStorage"
			/>
			<br />
			<input
				type="button"
				id="boutonSuppression"
				value="Suppression de l'entrée dans localStorage"
				onclick="supprimerLocalStorage();"
			/>
		</form>

		<!-- Début script JavaScript -->
		<script type='text/javascript'>
			/* Lecture depuis le localStorage */
			document.getElementById('boutonLecture').onclick = function() {
				/* Test possibilité d'utiliser localStorage et JSON */
				if ( typeof localStorage != "undefined" && JSON) {
					/* Désérialisation de l'objet JSON lu */
					var coordonneesPersonne = JSON.parse(localStorage.getItem("identite"));
					/* Mise à jour des champs d'affichage
					 (<input type="texte" ... />) */
					document.getElementById("nom").value = coordonneesPersonne.nom;
					document.getElementById("prenom").value = coordonneesPersonne.prenom;
					document.getElementById("mail").value = coordonneesPersonne.mail;
					/* Affichage de contrôle */
					alert("Lecture depuis localStorage effectuée");
				} else {
					/* Message d'erreur (pas de possibilité
					 de stockage localStorage) */
					alert("localStorage n'est pas supporté");
				}
			};

		</script>

		<!-- Affichage du code source -->
		<br />
		<br />
		<br />
		<center>
			<a href="JavaScript:window.location='view-source:' + window.location"> Code source </a>
		</center>

	</body>

</html>