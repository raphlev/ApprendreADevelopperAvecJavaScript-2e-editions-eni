<!DOCTYPE html>

<!--
Nom du script : promise.htm
Auteur : Christian VIGOUROUX
Date de création : 19/04/2016
Date de dernière modification : 19/4/2016
Objet : Utilisation des promesses
-->

<!-- Balise HTML -->
<html>

  <!-- Section HEAD -->
  <head>
    <!-- Balise meta de gestion de l'accentuation UTF-8 -->
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  </head>

  <!-- Section BODY -->
  <body>

    <!-- Utilisation de la police de caractères Arial -->
    <font face="Arial">
            
      <!-- Affichage du titre du script -->
      <h3>EcmaScript 6 : Utilisation des promesses</h3>

      <!-- Script JavaScript -->
      <script>

        // Définition d'une promesse
        // NB1 : Le traitement consiste à tester la vitesse atteinte
        // par deux voitures de sport au bout de 5 secondes
        // NB2 : La voiture gagnante est tirée de manière aléatoire
        // par Math.random (qui fournit une réponse entre 0 et 1)
        document.write("Démarrage des deux voitures");
        document.write(" Porsche 911 vs Ferrari Testarossa<br />");
        var maPromesse = new Promise(function(resolve, reject) {
          // Délai de 5 secondes
          setTimeout(function() {
            // Tirage aléatoire de la voiture la plus rapide
            if (Math.random()>0.5) {
              // Porsche 911
              // NB : le choix de placer cette voiture
              // dans le cas resolve est arbitraire
              resolve("La Porsche 911 est la plus rapide");
            } else {
              // Ferrari Testarossa
              // NB : le choix de placer cette voiture
              // dans le cas reject est arbitraire
              reject("Ferrari Testarossa est la plus rapide");
            }  
          }, 5000);
        });

        // Affichage alors que la promesse n'a pas encore été traitée
        // (traitement asynchrone))
        document.write("Contrôle radar dans 5 secondes");

        // Compte-rendu du fonctionnement de la promesse
        maPromesse
          .then(function(verdict) {
             // Cas Porsche 911
             alert("Verdict : " + verdict);
          })
          .catch(function(verdict) {
            // Cas Ferrari Testorossa
            alert("Verdict : " + verdict);
          });

      </script>

    </font>

  </body>

</html>